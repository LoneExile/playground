# base kube

## [cert-manager](https://cert-manager.io/docs/installation/#default-static-install)

```bash
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml
```

## [metallb](https://metallb.universe.tf/installation/#installation-by-manifest)

```bash
kubectl apply -f https://raw.githubusercontent.com/metallb/metallb/v0.13.11/config/manifests/metallb-native.yaml
```

## prometheus

```bash
git clone https://github.com/prometheus-operator/kube-prometheus.git
cd kube-prometheus
kubectl create -f manifests/setup
until kubectl get servicemonitors --all-namespaces ; do date; sleep 1; echo ""; done
kubectl create -f manifests/

```

## rook-ceph

```bash

## install rook-ceph
git clone --single-branch --branch v1.12.4 https://github.com/rook/rook.git
cd rook/deploy/examples
kubectl create -f crds.yaml -f common.yaml -f operator.yaml
kubectl create -f cluster.yaml
kubectl create -f toolbox.yaml

# kubectl create -f storageclass.yaml
# kubectl create -f filesystem.yaml
# kubectl create -f object.yaml
# kubectl create -f pool.yaml

## uninstall rook-ceph
kubectl delete -f crds.yaml -f common.yaml -f operator.yaml -f cluster.yaml -f toolbox.yaml -n rook-ceph
sudo rm -rf /var/lib/rook
```

## format and mount cephfs

```bash

# `d` command to delete the partition.
# `n` command to create a new partition.
# `p` command to make the new partition primary.
# `1` command to make this the first partition.
# `w` command to write the table and exit.
sudo fdisk /dev/sda

# sudo mkfs.ext4 /dev/sda1

# -------
# set name in cluster.yaml
# kubectl get node orangepi5 --show-labels
# NAME        STATUS   ROLES                  AGE   VERSION        LABELS
# orangepi5   Ready    control-plane,master   25h   v1.27.4+k3s1   beta.kubernetes.io/arch=arm64,beta.kubernetes.io/instance-type=k3s,beta.kubernetes.io/os=linux,kubernetes.io/arch=arm64,kubernetes.io/hostname=orangepi5,kubernetes.io/os=linux,node-role.kubernetes.io/control-plane=true,node-role.kubernetes.io/master=true,node.kubernetes.io/instance-type=k3s
# -------


## mount cephfs
# sudo mkdir -p /mnt/cephfs
# sudo mount -t ext4 /dev/sda1 /mnt/cephfs
# sudo chmod 777 /mnt/cephfs
# sudo chown -R 1000:1000 /mnt/cephfs

## umount cephfs
# sudo umount /mnt/cephfs
# sudo rm -rf /mnt/cephfs
# sudo rm -rf /var/lib/rook

```

## [kubernetes-dashboard]
